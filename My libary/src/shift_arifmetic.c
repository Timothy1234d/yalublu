#include <stdio.h>
#include <my_functions.h>

// ??????? ??? ?????? ???????? ????? ? ???????? ????
void printBinary(unsigned char port) {
    for (int i = 7; i >= 0; i--) {
        printf("%d", (port >> i) & 1); // ????????? ?????? ???
    }
    printf("\n");
}
// ???????? ?????? ?????????
void run_shift_arifmetic() {
    unsigned char port = 0x00; // ????????? ???????? ?????
    int choice, shift;

    // ????? ?????????? ????????? ?????
    printf("????????? ????????? ?????:\n");
    printf("???????? ???: ");
    printBinary(port);
    printf("????????????????? ???: 0x%02X\n", port);

    while (1) {
        // ???? ?????? ????????
        printf("\n???????? ????????:\n");
        printf("1. ????? ?????\n");
        printf("2. ????? ??????\n");
        printf("3. ?????????? ????? ???????? ?????\n");
        printf("4. ?????\n");
        printf("??? ?????: ");
        scanf_s("%d", &choice);

        if (choice == 4) {
            printf("????????? ?????????.\n");
            break;
        }

        switch (choice) {
        case 1: // ????? ?????
            printf("??????? ?????????? ??????? ??? ?????? ????? (0-7): ");
            scanf_s("%d", &shift);
            if (shift < 0 || shift > 7) {
                printf("??????: ?????????? ??????? ?????? ???? ? ????????? 0-7.\n");
                break;
            }
            port = port << shift;
            printf("????????? ????? ?????? ?????:\n");
            printf("???????? ???: ");
            printBinary(port);
            printf("????????????????? ???: 0x%02X\n", port);
            break;

        case 2: // ????? ??????
            printf("??????? ?????????? ??????? ??? ?????? ?????? (0-7): ");
            scanf_s("%d", &shift);
            if (shift < 0 || shift > 7) {
                printf("??????: ?????????? ??????? ?????? ???? ? ????????? 0-7.\n");
                break;
            }
            port = port >> shift;
            printf("????????? ????? ?????? ??????:\n");
            printf("???????? ???: ");
            printBinary(port);
            printf("????????????????? ???: 0x%02X\n", port);
            break;

        case 3: // ?????????? ????? ???????? ?????
            printf("??????? ????? ???????? ????? (0-255): ");
            int new_value;
            scanf_s("%d", &new_value);
            if (new_value < 0 || new_value > 255) {
                printf("??????: ???????? ?????? ???? ? ????????? 0-255.\n");
                break;
            }
            port = (unsigned char)new_value;
            printf("????? ????????? ?????:\n");
            printf("???????? ???: ");
            printBinary(port);
            printf("????????????????? ???: 0x%02X\n", port);
            break;

        default:
            printf("??????: ???????? ????? ????????.\n");
            break;
        }
    }

}